<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>my promise ajax</title>
  <script src="../js/comm/traceur.js"></script>
  <script src="../js/comm/bootstrap.js"></script>
</head>
<body>
  <div>用ES6 Promise 对象处理多个ajax请求</div>
  <!-- 不适用promise.all -->
  <script type="module">
    'use strict';
    var ajaxHandler = function(url){
      return new Promise(function(resolve,reject){
        var req = new XMLHttpRequest();
        req.open('GET',url,true);

        req.onload = function(){
          if(req.status === 200){
            resolve(req.responseText);
          }else{
            reject(new Error(req.status));
          }
        };

        req.onerror = function(){
          reject(new Error(req.status));
        };
        req.send();
      });
    };

    var request = {
      mockData1:function(){
        console.log('请求mockData1');
        return ajaxHandler('/mockData1');
      },
      mockData2:function(){
        console.log('请求mockData2');
        return ajaxHandler('/mockData2');
      }
    };

    //主函数
    var main = function(){
      request.mockData1()
      //注意这里request.mockData2
      //是一个方法函数而非一个执行函数
      .then(request.mockData2)
      .then(function(){
        console.log('mockData1与mockData2均请求结束....');
      });
    };
    //main();
    //
    var main2 = function(){
      return Promise.all([])
    };

    main2();
  </script>
</body>
</html>