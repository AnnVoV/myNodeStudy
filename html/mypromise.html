<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>my promise study</title>
  <script src="../js/comm/traceur.js"></script>
  <script src="../js/comm/bootstrap.js"></script>
</head>
<body>
  <div>Promise 学习使用</div>
  <input type="button" value="发起请求" id="requestData" />
  <div id="container"></div>
  <!--<script type="module">
 
  'use strict';
  function searchTwitter(){
    var xhr,
        url,
        results,
        promise;

    url = '/mockData';
    promise = new Promise(function(resolve,reject){
      xhr = new XMLHttpRequest();
      xhr.open('GET',url,true);

      xhr.onload = function(e){
        if(this.status === 200){
          results = JSON.parse(this.responseText);
          resolve(results);
        }
      };

      xhr.onerror = function(e){
        reject(e);
      };

      xhr.send();
    });
    return promise;//返回promise对象
  }

  function loadTwitter(){
    var container = document.getElementById('container');
    //为什么这样写就比较推荐
    searchTwitter().then(function(data){
      successHandler(data);
    },errorHandler);

    var errorHandler = function(){
      console.log('请求数据失败');
    };

    var successHandler = function(data){
      console.log(data);
      for(var key in data){
        console.log(key,':',data[key]);
        var div = document.createElement('div');
        div.innerText = key+': '+data[key];
        container.appendChild(div);
      }
    }
  }

  //主函数
  var main = function(){
    loadTwitter();
  };

  main();

  </script>-->
  <script type="module">
  function taskA() {
    console.log("Task A");
    throw new Error("throw Error @ Task A");
  }
  function taskB() {
    console.log("Task B");// 不会被调用
  }
  function onRejected(error) {
    console.log(error);// => "throw Error @ Task A"
  }
  function finalTask() {
    console.log("Final Task");
  }

  var promise = Promise.resolve();
  promise
    .then(taskA)
    .then(taskB)
    .catch(onRejected)
    .then(finalTask);
  </script>
</body>
</html>