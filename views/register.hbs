<div class="m-content">
<form action="/registerHandler" method="post" name="regForm" role="form">
  <table class="table table-striped">
    <tr>
      <td>Location</td>
      <td>Size</td>
      <td>Price</td>
      <td>Status</td>
    </tr>
    {{#places}}
      <tr>
        <td>
          <span class="j-place">{{place}}</span>
          <input type="hidden" value={{place}} name="location"/>
        </td>
        <td><input type="number" class="m-input j-size" min="{{../minSize}}" max="{{../maxSize}}" value="1" name="size"/></td>
        <td>
          <span class="j-price">{{price}}</span>
          <input type="hidden" value={{price}} name="price"/>
        </td>
        <td>
          <button class="btn btn-primary j-order">预定</button>
          <button class="btn btn-danger j-cancel">取消</button>
        </td>
      </tr>
    {{/places}}
  </table>
  <!-- 表单里面的值一定要有传的值对应的name!!!不然页面无法跳转的 -->
  <input type="hidden" value="ann" name="name"/>
  <input type="hidden" value="1051961997@qq.com" name="email"/>
</form>
<div>
  <input type="button" value="查看购物车" class="btn j-car"/>
</div>
  <p class="bg-success m-hide j-tip">
    已经成功添加到订单！
  </p>
</div>

<script>
  $(function(){
    var jqDom = {
      order:$('.j-order'),
      shoppingcar:$('.j-car')
    };

    var controller = {
      initial:function(){
        var pointer = this;//指向controller的指针
        jqDom.order.on('click',function(){
          var data = model.setData($(this));
          model.refreshData(data.location,data.size,data.price);
          console.log(data);
          pointer.ajaxRequest();
        });
        pointer.showCar();
      },
      ajaxRequest:function(){
        console.log('data: ',model.data);
        $.ajax(
          {
            url:'/registerHandler',
            type:'post',
            data:model.data,
            success:function(){
              console.log('success....');
            },
            error:function(){
              console.log('error....');
            }
          }
        );
      },
      showCar:function(){
        jqDom.shoppingcar.on('click',function(){
          console.log('show detail in car...');
          window.location.href= '/orderList';
        });
      }
    };

    var view = {
    };

    var model = {
      data:'',
      refreshData:function(loca,size,price){
        this.data = {
          location:loca,
          size:size,
          price:price
        };
      },
      setData:function($elm){
        var $row = $elm.parent().parent(),
            location = $row.find('.j-place').html(),
            size = $row.find('.j-size').val(),
            price = $row.find('.j-price').html();

        return {
          location:location,
          size:size,
          price:price
        };
      }
    };

    //入口脚本
    var main = function(){
      controller.initial();
    };

    main();
  });
</script>



